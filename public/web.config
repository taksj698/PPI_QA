<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>

    <directoryBrowse enabled="false" />

    <rewrite>
      <rules>

        <!-- 1) ตัด / ท้าย -->
        <rule name="Remove trailing slash" stopProcessing="true">
          <match url="(.+)/$" />
          <conditions>
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
          </conditions>
          <action type="Redirect" url="/{R:1}" redirectType="Permanent" />
        </rule>

        <!-- 2) ปล่อย Next static assets (_next) -->
        <rule name="Allow _next assets" stopProcessing="true">
          <match url="^_next/.*" />
          <action type="None" />
        </rule>

        <!-- 3) ปล่อยไฟล์ static จริง (css/js/png/etc) -->
        <rule name="Allow static files" stopProcessing="true">
          <match url=".*\.(js|css|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot|json|map)$" />
          <action type="None" />
        </rule>

        <!-- 4) route → route.html (เช่น /qc → qc.html) -->
        <rule name="Route html" stopProcessing="true">
          <match url="^(.+)$" />
          <conditions>
            <add input="{DOCUMENT_ROOT}\{R:1}.html" matchType="IsFile" />
          </conditions>
          <action type="Rewrite" url="{R:1}.html" />
        </rule>

        <!-- 5) fallback → index.html -->
        <rule name="SPA fallback" stopProcessing="true">
          <match url=".*" />
          <action type="Rewrite" url="/index.html" />
        </rule>

      </rules>
    </rewrite>

  </system.webServer>
</configuration>
